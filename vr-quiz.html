<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VR Quiz Moving Questions</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>body { margin:0; overflow:hidden; }</style>
</head>
<body>
  <a-scene>

    <a-assets>
      <img id="customBG" src="https://cdn.pixabay.com/photo/2024/01/17/19/29/ai-generated-8515503_1280.png" crossorigin="anonymous">
      <img id="correctSign" src="https://cdn.pixabay.com/photo/2014/03/24/17/21/wrong-295503_1280.png">
      <img id="wrongSign" src="https://cdn.pixabay.com/photo/2012/04/13/00/22/red-31226_960_720.png">
      <audio id="correctAudio" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_2d9a1f43a0.mp3?filename=correct-2-6280.mp3" preload="auto"></audio>
      <audio id="wrongAudio" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_5f93d2e7c5.mp3?filename=wrong-6281.mp3" preload="auto"></audio>
    </a-assets>

    <a-entity camera look-controls position="0 1.6 0">
      <a-entity cursor="fuse:true; fuseTimeout:500"
                raycaster="objects:.clickable"
                position="0 0 -1"
                geometry="primitive:ring; radiusInner:0.02; radiusOuter:0.03"
                material="color: cyan; shader: flat"></a-entity>
    </a-entity>

    <a-sky src="#customBG"></a-sky>

    <!-- Question -->
    <a-entity id="question" position="0 2.5 -3" text="value: ; align:center; width:5; color:#FFF;"></a-entity>

    <!-- Answer boxes + text -->
    <a-box id="option1" class="clickable" depth="0.2" height="0.5" width="1.8" color="#FFC107"></a-box>
    <a-text id="text1" value="" align="center" color="#000" width="2.5"></a-text>

    <a-box id="option2" class="clickable" depth="0.2" height="0.5" width="1.8" color="#8BC34A"></a-box>
    <a-text id="text2" value="" align="center" color="#000" width="2.5"></a-text>

    <a-box id="option3" class="clickable" depth="0.2" height="0.5" width="1.8" color="#03A9F4"></a-box>
    <a-text id="text3" value="" align="center" color="#000" width="2.5"></a-text>

    <a-image id="sign" src="" scale="0.8 0.8 0.8" visible="false"></a-image>

    <!-- Score -->
    <a-entity id="score" position="0 3.2 -3" text="value: Score: 0; align:center; color:#FFF; width:4;"></a-entity>

    <!-- Replay -->
    <a-box id="replay" class="clickable" depth="0.2" height="0.5" width="2" color="#FF9800" visible="false"></a-box>
    <a-text id="replayText" value="Replay Quiz" align="center" position="0 -1 -2.7" color="#000" width="2.5" visible="false"></a-text>

    <a-entity id="correctSound" sound="src: #correctAudio"></a-entity>
    <a-entity id="wrongSound" sound="src: #wrongAudio"></a-entity>

    <script>
      const quiz = [
        { q: "Which data type is 25?", options: ["Text","Number","Color"], answer: 1 },
        { q: "Which data type is 'Blue'?", options: ["Text","Number","Color"], answer: 2 },
        { q: "Which data type is 'Hello'?", options: ["Text","Number","Sound"], answer: 0 },
        { q: "Which data type is 02:30 PM?", options: ["Date","Time","Number"], answer: 1 },
        { q: "Which data type is 12/09/2025?", options: ["Date","Color","Sound"], answer: 0 }
      ];

      let current = 0;
      let score = 0;
      const boxes = ["option1","option2","option3"];
      const texts = ["text1","text2","text3"];
      const signEl = document.querySelector("#sign");

      function randomPosition() {
        return {
          x: (Math.random() * 6) - 3,  // -3 to 3
          y: 1.5 + Math.random() * 1.5, // 1.5 to 3
          z: -2 - Math.random() * 4 // -2 to -6
        };
      }

      function loadQuestion(index) {
        const q = quiz[index];
        const qPos = randomPosition();
        document.querySelector("#question").setAttribute("text", "value", q.q);
        document.querySelector("#question").setAttribute("position", qPos);

        boxes.forEach((id,i) => {
          const pos = {
            x: qPos.x + (i-1)*2,
            y: qPos.y - 1,
            z: qPos.z
          };
          document.querySelector(`#${id}`).setAttribute("position", pos);
          document.querySelector(`#${texts[i]}`).setAttribute("position", {x: pos.x, y: pos.y, z: pos.z + 0.3});
          document.querySelector(`#${texts[i]}`).setAttribute("value", q.options[i]);
        });

        signEl.setAttribute("visible", "false");
      }

      AFRAME.registerComponent('gaze-listener', {
        init: function() {
          this.el.addEventListener('click', () => {
            const idx = boxes.indexOf(this.el.id);
            const box = document.querySelector(`#${boxes[idx]}`);
            const pos = box.getAttribute("position");
            if (idx === quiz[current].answer) {
              score += 10;
              document.querySelector('#correctSound').components.sound.playSound();
              signEl.setAttribute("src", "#correctSign");
            } else {
              document.querySelector('#wrongSound').components.sound.playSound();
              signEl.setAttribute("src", "#wrongSign");
            }
            signEl.setAttribute("position", { x: pos.x, y: pos.y + 0.7, z: pos.z });
            signEl.setAttribute("visible", "true");

            document.querySelector('#score').setAttribute("text", "value", `Score: ${score}`);

            setTimeout(() => {
              current++;
              if (current < quiz.length) {
                loadQuestion(current);
              } else {
                document.querySelector("#question").setAttribute("text", "value", "ðŸŽ‰ Quiz Finished!");
                boxes.forEach(b => document.querySelector(`#${b}`).setAttribute("visible", "false"));
                texts.forEach(t => document.querySelector(`#${t}`).setAttribute("visible", "false"));
                signEl.setAttribute("visible", "false");
                document.querySelector("#replay").setAttribute("visible", "true");
                document.querySelector("#replayText").setAttribute("visible", "true");
              }
            }, 1000);
          });
        }
      });

      AFRAME.registerComponent('gaze-listener-replay', {
        init: function() {
          this.el.addEventListener('click', () => {
            score = 0;
            current = 0;
            document.querySelector('#score').setAttribute("text", "value", "Score: 0");
            document.querySelector("#replay").setAttribute("visible", "false");
            document.querySelector("#replayText").setAttribute("visible", "false");
            boxes.forEach(b => document.querySelector(`#${b}`).setAttribute("visible", "true"));
            texts.forEach(t => document.querySelector(`#${t}`).setAttribute("visible", "true"));
            loadQuestion(current);
          });
        }
      });

      boxes.forEach(id => document.querySelector(`#${id}`).setAttribute('gaze-listener', ''));
      document.querySelector('#replay').setAttribute('gaze-listener-replay', '');
      loadQuestion(current);
    </script>
  </a-scene>
</body>
</html>
